import numpy as np
import matplotlib.pyplot as plt
from scipy.spatial import cKDTree

points = {(2.0, 7.0, 14.75, 1.0), (9.0, 3.5, 9.25, 1.0), (5.5, 3.5, 8.05, 1.0), (5.5, 2.0, 8.05, 1.0),
          (9.0, 3.5, 6.5, 0.5), (32.5, 2.0, 22.0, 1.0), (2.0, 5.5, 9.3, 0.5), (13.0, 2.0, 13.05, 0.5),
          (13.0, 4.5, 15.3, 1.0), (5.5, 6.0, 11.0, 0.5), (37.0, 7.0, 31.5, 1.0), (2.0, 3.5, 7.95, 0.5),
          (5.5, 3.5, 12.2, 1.0), (13.0, 2.0, 13.45, 1.0), (32.5, 3.5, 21.4, 0.5), (17.0, 3.5, 17.1, 1.0),
          (37.0, 5.5, 26.0, 0.5), (5.5, 8.0, 17.3, 1.0), (37.0, 7.0, 30.0, 0.5), (9.0, 6.0, 16.65, 1.0),
          (2.0, 3.5, 10.9, 1.0), (5.5, 5.0, 10.5, 0.5), (9.0, 3.5, 14.15, 1.0), (5.5, 7.0, 15.4, 0.5),
          (13.0, 5.0, 16.8, 1.0), (5.5, 5.0, 12.0, 1.0), (5.5, 3.5, 7.05, 0.5), (13.0, 3.5, 13.15, 0.5),
          (17.0, 3.5, 18.200000000000003, 0.5), (13.0, 3.5, 16.8, 1.0), (32.5, 2.0, 23.5, 0.5), (17.0, 3.5, 18.6, 1.0),
          (37.0, 5.5, 27.5, 0.5), (9.0, 3.5, 11.65, 1.0), (9.0, 4.5, 10.25, 0.5), (5.5, 5.0, 9.5, 1.0),
          (13.0, 6.0, 21.950000000000003, 1.0), (28.0, 3.5, 21.0, 0.5), (13.0, 5.0, 18.05, 0.5), (9.0, 6.0, 17.5, 1.0),
          (37.0, 3.5, 23.5, 0.5), (5.5, 4.5, 10.7, 0.5), (9.0, 4.5, 15.9, 1.0), (13.0, 3.5, 18.450000000000003, 1.0),
          (9.0, 3.5, 11.75, 1.0), (2.0, 7.0, 12.95, 0.5), (9.0, 4.5, 11.25, 1.0), (2.0, 7.0, 13.7, 1.0),
          (13.0, 6.0, 19.3, 1.0), (5.5, 7.0, 14.8, 1.0), (32.5, 5.0, 23.9, 0.5), (5.5, 2.0, 7.0, 1.0),
          (9.0, 4.5, 13.15, 0.5), (32.5, 3.5, 22.9, 1.0), (37.0, 7.0, 28.5, 0.5), (5.5, 8.0, 15.7, 0.5),
          (5.5, 7.0, 18.35, 1.0), (5.5, 8.0, 19.2, 1.0), (28.0, 3.5, 20.9, 1.0), (32.5, 2.0, 17.4, 0.5),
          (9.0, 6.0, 15.0, 1.0), (13.0, 6.0, 16.8, 1.0), (2.0, 7.0, 11.5, 1.0), (9.0, 6.0, 18.4, 1.0),
          (17.0, 3.5, 16.700000000000003, 0.5), (9.0, 4.5, 14.15, 1.0), (2.0, 7.0, 12.55, 1.0), (13.0, 5.0, 15.65, 0.5),
          (32.5, 2.0, 16.0, 0.5), (13.0, 4.5, 14.3, 0.5), (5.5, 7.0, 15.55, 1.0), (5.5, 8.0, 16.7, 1.0),
          (9.0, 6.0, 12.5, 1.0), (5.5, 8.0, 16.25, 1.0), (9.0, 3.5, 10.0, 1.0), (17.0, 3.5, 16.7, 0.5),
          (32.5, 3.5, 20.0, 0.5), (32.5, 2.0, 18.9, 0.5), (5.5, 7.0, 16.15, 1.0), (13.0, 5.0, 16.05, 1.0),
          (9.0, 3.5, 7.5, 1.0), (2.0, 7.0, 13.600000000000001, 1.0), (9.0, 6.0, 19.15, 1.0), (32.5, 3.5, 24.75, 0.5),
          (9.0, 4.5, 14.25, 1.0), (5.5, 5.0, 15.850000000000001, 1.0), (37.0, 7.0, 31.5, 0.5), (2.0, 3.5, 7.55, 1.0),
          (13.0, 4.5, 13.9, 0.5), (13.0, 5.0, 20.950000000000003, 1.0), (5.5, 8.0, 15.55, 1.0), (13.0, 3.5, 16.95, 1.0),
          (32.5, 5.0, 22.4, 0.5), (17.0, 3.5, 15.700000000000001, 0.5), (5.5, 5.0, 8.75, 0.5), (32.5, 5.0, 21.0, 0.5),
          (13.0, 3.5, 11.4, 0.5), (13.0, 2.0, 11.4, 0.5), (9.0, 4.5, 9.0, 0.5), (2.0, 5.5, 10.45, 0.5),
          (17.0, 3.5, 16.1, 1.0), (13.0, 5.0, 17.8, 1.0), (13.0, 2.0, 11.8, 1.0), (13.0, 6.0, 18.9, 0.5),
          (2.0, 3.5, 5.75, 0.5), (13.0, 2.0, 14.45, 1.0), (32.5, 3.5, 18.5, 0.5), (2.0, 3.5, 6.5, 1.0),
          (5.5, 7.0, 13.75, 0.5), (5.5, 2.0, 10.850000000000001, 1.0), (13.0, 6.0, 23.450000000000003, 1.0),
          (5.5, 7.0, 14.5, 1.0), (28.0, 3.5, 19.5, 1.0), (5.5, 6.0, 13.2, 0.5), (13.0, 6.0, 20.950000000000003, 1.0),
          (13.0, 5.0, 19.450000000000003, 1.0), (5.5, 2.0, 3.75, 0.5), (17.0, 3.5, 19.6, 1.0), (13.0, 6.0, 20.55, 0.5),
          (5.5, 8.0, 15.5, 0.5), (13.0, 3.5, 15.3, 1.0), (13.0, 2.0, 12.8, 1.0), (28.0, 3.5, 17.9, 1.0),
          (13.0, 6.0, 19.55, 1.0), (28.0, 3.5, 19.3, 1.0), (2.0, 7.0, 11.8, 0.5), (32.5, 3.5, 21.5, 0.5),
          (5.5, 8.0, 14.5, 1.0), (32.5, 5.0, 25.5, 0.5), (9.0, 4.5, 11.5, 0.5), (13.0, 3.5, 16.05, 1.0),
          (28.0, 3.5, 24.0, 0.5), (5.5, 7.0, 15.95, 1.0), (2.0, 7.0, 15.899999999999999, 1.0),
          (5.5, 7.0, 17.200000000000003, 1.0), (2.0, 3.5, 6.8, 0.5), (9.0, 6.0, 20.8, 1.0), (5.5, 8.0, 18.05, 1.0),
          (9.0, 4.5, 12.5, 1.0), (17.0, 3.5, 15.7, 0.5), (2.0, 5.5, 11.2, 1.0), (9.0, 3.5, 15.8, 1.0),
          (32.5, 2.0, 19.0, 0.5), (28.0, 3.5, 22.5, 1.0), (9.0, 6.0, 16.0, 1.0), (13.0, 6.0, 21.8, 1.0),
          (17.0, 3.5, 18.1, 1.0), (9.0, 3.5, 10.5, 1.0), (9.0, 3.5, 7.75, 0.5), (13.0, 4.5, 17.05, 1.0),
          (32.5, 2.0, 20.5, 0.5), (37.0, 3.5, 25.0, 0.5), (5.5, 6.0, 15.95, 1.0), (32.5, 3.5, 23.15, 0.5),
          (9.0, 3.5, 12.5, 1.0), (5.5, 3.5, 11.15, 1.0), (32.5, 5.0, 28.5, 0.5), (9.0, 3.5, 11.25, 1.0),
          (5.5, 5.0, 13.45, 1.0), (13.0, 4.5, 18.55, 1.0), (9.0, 6.0, 15.65, 0.5), (5.5, 8.0, 13.5, 0.5),
          (5.5, 5.0, 14.2, 1.0), (2.0, 7.0, 10.75, 0.5), (5.5, 2.0, 5.0, 0.5), (32.5, 5.0, 24.0, 0.5),
          (2.0, 3.5, 8.6, 1.0), (9.0, 3.5, 8.75, 1.0), (5.5, 8.0, 20.85, 1.0), (9.0, 3.5, 13.4, 1.0),
          (28.0, 3.5, 16.5, 1.0), (5.5, 6.0, 14.2, 1.0), (9.0, 3.5, 10.65, 0.5), (5.5, 5.0, 11.25, 1.0),
          (13.0, 5.0, 16.4, 0.5), (5.5, 3.5, 10.95, 1.0), (5.5, 6.0, 12.05, 0.5), (5.5, 8.0, 17.0, 1.0),
          (5.5, 8.0, 14.55, 0.5), (13.0, 4.5, 19.3, 1.0), (13.0, 6.0, 20.3, 1.0), (5.5, 8.0, 13.75, 0.5),
          (5.5, 6.0, 12.0, 1.0), (13.0, 4.5, 13.3, 0.5), (17.0, 3.5, 21.1, 1.0), (13.0, 3.5, 13.55, 1.0),
          (2.0, 3.5, 8.7, 1.0), (5.5, 3.5, 6.0, 0.5), (5.5, 5.0, 12.3, 1.0), (5.5, 7.0, 13.75, 1.0),
          (13.0, 3.5, 13.9, 0.5), (9.0, 6.0, 13.25, 0.5), (5.5, 5.0, 13.05, 1.0), (13.0, 6.0, 17.8, 1.0),
          (13.0, 3.5, 11.8, 1.0), (13.0, 5.0, 18.450000000000003, 1.0), (5.5, 7.0, 16.7, 1.0), (9.0, 6.0, 16.75, 1.0),
          (13.0, 6.0, 18.55, 1.0), (32.5, 5.0, 27.0, 1.0), (28.0, 3.5, 22.4, 0.5), (13.0, 6.0, 21.05, 1.0),
          (5.5, 6.0, 13.05, 1.0), (5.5, 3.5, 9.2, 1.0), (5.5, 2.0, 9.2, 1.0), (37.0, 3.5, 26.75, 0.5),
          (5.5, 5.0, 10.55, 1.0), (13.0, 3.5, 14.3, 1.0), (32.5, 3.5, 24.5, 1.0), (9.0, 6.0, 14.0, 0.5),
          (2.0, 3.5, 9.75, 1.0), (13.0, 3.5, 15.55, 0.5), (13.0, 4.5, 14.3, 1.0), (13.0, 6.0, 18.15, 0.5),
          (5.5, 3.5, 7.0, 1.0), (5.5, 2.0, 5.75, 1.0), (13.0, 3.5, 15.95, 1.0), (5.5, 3.5, 13.350000000000001, 1.0),
          (5.5, 8.0, 18.45, 1.0), (9.0, 6.0, 14.25, 1.0), (37.0, 3.5, 26.5, 1.0), (13.0, 2.0, 10.15, 0.5),
          (5.5, 7.0, 13.0, 0.5), (13.0, 2.0, 15.950000000000001, 1.0), (9.0, 3.5, 9.0, 0.5), (9.0, 6.0, 11.5, 0.5),
          (13.0, 6.0, 16.4, 0.5), (37.0, 7.0, 31.75, 0.5), (9.0, 4.5, 16.65, 1.0), (13.0, 3.5, 14.55, 1.0),
          (5.5, 6.0, 16.7, 1.0)}


points = np.array(list(points))
values = points[:,3]
points = points[:,:-1]




x_min, x_max = np.min(points[:, 0]), np.max(points[:, 0])
y_min, y_max = np.min(points[:, 1]), np.max(points[:, 1])
z_min, z_max = np.min(points[:, 2]), np.max(points[:, 2])
grid_x, grid_y, grid_z = np.meshgrid(np.arange(x_min - 10, x_max + 10, 1),
                                     np.arange(y_min - 10, y_max + 10, 1),
                                     np.arange(z_min - 10, z_max + 10, 1))

grid_points = np.vstack((grid_x.flatten(), grid_y.flatten(), grid_z.flatten())).T

tree = cKDTree(points)
indices = tree.query_ball_point(grid_points, r=5)

result = set()

for i in range(len(indices)):
    if len(indices[i]) > 0:
        point_sum = np.zeros(3)
        for index in indices[i]:
            point_sum += points[index]
        center = point_sum / len(indices[i])
        result.add(tuple(center))

interpolated_points = np.array(list(result))

# from scipy.interpolate import LinearNDInterpolator
#
# def custom_interpolator(points, values, grid_points):
#     interpolator = LinearNDInterpolator(points, values)
#     interpolated_values = interpolator(grid_points)
#     return interpolated_values
#
#
# interpolated_values = custom_interpolator(points_[:,:-1], points_[:, 3], converted_grid_points)


x = [point[0] for point in points]
y = [point[1] for point in points]
z = [point[2] for point in points]

x_ = [point[0] for point in interpolated_points]
y_ = [point[1] for point in interpolated_points]
z_ = [point[2] for point in interpolated_points]

# инициализация фигуры и оси 3D графика
fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')

# отображение точек разными цветами и маркерами
ax.scatter(x, y, z, c='green', marker='o')
ax.scatter(x_, y_, z_, c='black', marker='.')

# подпись осей
ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_zlabel('Z')

# показать график
plt.show()
